<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ú©ØªØ±Ù Ø±ÙØ¨Ø§ØªÛŒÚ© â€” ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯ÛŒØ§Ø¨Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient-light: linear-gradient(135deg, #f0f4ff 0%, #f9fafc 100%);
            --bg-gradient-dark: linear-gradient(135deg, #0b1122 0%, #0f172a 100%);
            --card-bg: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --danger: #e53e3e;
            --success: #38a169;
            --border: #e2e8f0;
            --shadow: 0 6px 16px rgba(0,0,0,0.06);
            --shadow-hover: 0 8px 20px rgba(0,0,0,0.08);
        }
        [data-theme="dark"] {
            --card-bg: #1e293b;
            --text: #e2e8f0;
            --text-light: #94a3b8;
            --border: #334155;
            --shadow: 0 6px 16px rgba(0,0,0,0.2);
            --shadow-hover: 0 8px 24px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-gradient-light);
            background-attachment: fixed;
            color: var(--text);
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            padding: 20px;
            transition: background 0.6s ease, color 0.4s ease;
            line-height: 1.6;
        }

        [data-theme="dark"] body {
            background: var(--bg-gradient-dark);
        }

        .logo-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .logo-header h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(90deg, var(--primary), #7209b7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.15rem;
            margin-bottom: 20px;
        }

        .info-note {
            background: rgba(74, 107, 255, 0.06);
            border-right: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: 10px;
            font-size: 0.98rem;
            margin-bottom: 26px;
            color: var(--text-light);
            line-height: 1.6;
        }
        [data-theme="dark"] .info-note {
            background: rgba(94, 96, 206, 0.12);
        }
        html[dir="ltr"] .info-note {
            border-right: none;
            border-left: 4px solid var(--primary);
        }

        .container {
            max-width: 720px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 28px;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .form-group {
            margin-bottom: 22px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.02rem;
            color: var(--text);
        }

        input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1.05rem;
            background: var(--card-bg);
            color: var(--text);
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            letter-spacing: -0.5px;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-box {
            padding: 28px;
            border-radius: 18px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            display: none;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .result-0 {
            background: rgba(56, 161, 105, 0.1);
            color: var(--success);
            border-color: var(--success);
        }

        .result-1 {
            background: rgba(229, 62, 62, 0.1);
            color: var(--danger);
            border-color: var(--danger);
        }

        .rule-info {
            margin-top: 20px;
            font-size: 1rem;
            color: var(--text-light);
            padding: 16px;
            background: rgba(67, 97, 238, 0.07);
            border-radius: 12px;
            border-right: 4px solid var(--primary);
        }
        html[dir="ltr"] .rule-info {
            border-right: none;
            border-left: 4px solid var(--primary);
        }

        .theme-toggle, .lang-toggle {
            position: fixed;
            top: 24px;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.4rem;
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: all 0.4s ease;
        }

        .theme-toggle:hover, .lang-toggle:hover {
            transform: rotate(20deg);
        }

        .theme-toggle {
            left: 24px;
        }

        .lang-toggle {
            right: 24px;
        }

        html[dir="ltr"] .theme-toggle {
            left: auto;
            right: 88px;
        }
        html[dir="ltr"] .lang-toggle {
            right: auto;
            left: 24px;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed var(--border);
            color: var(--text-light);
            font-size: 0.95rem;
        }

        @media (max-width: 600px) {
            .card { padding: 22px 20px; }
            .logo-header h1 { font-size: 2.0rem; }
            .btn { padding: 16px; font-size: 1.1rem; }
            .theme-toggle, .lang-toggle { width: 48px; height: 48px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle">
        <span id="themeIcon">ğŸŒ™</span>
    </div>

    <div class="lang-toggle" id="langToggle" aria-label="ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù† / Switch language">
        ğŸ‡¬ğŸ‡§ English
    </div>

    <div class="container">
        <header class="logo-header">
            <h1 id="title">Ø¯Ú©ØªØ±Ù Ø±ÙØ¨Ø§ØªÛŒÚ© ğŸ¤–ğŸ©º</h1>
            <p class="subtitle" id="subtitle">ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯ÛŒØ§Ø¨Øª â€” Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ù¾Ø²Ø´Ú©ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯</p>
        </header>

        <div class="info-note" id="infoNote">
            â„¹ï¸ Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± ÛŒÚ© <strong>ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</strong> Ø§Ø³Øª â€” Ù†Ù‡ ØªØ´Ø®ÛŒØµ Ù¾Ø²Ø´Ú©ÛŒ.  
            Ù†ØªØ§ÛŒØ¬ØŒ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ù‡Ø³ØªÙ†Ø¯.
        </div>

        <div class="card">
            <div class="form-group">
                <label for="glucose" id="glucoseLabel">Ú¯Ù„ÙˆÚ©Ø² (Glucose) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 50 ØªØ§ 200 mg/dL</label>
                <input type="number" id="glucose" placeholder="Ù…Ø«Ø§Ù„: 120" min="0" step="0.1">
            </div>
            <div class="form-group">
                <label for="bmi" id="bmiLabel">Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 15 ØªØ§ 60</label>
                <input type="number" id="bmi" placeholder="Ù…Ø«Ø§Ù„: 32.0" min="0" step="0.1">
            </div>
            <div class="form-group">
                <label for="bp" id="bpLabel">ÙØ´Ø§Ø± Ø®ÙˆÙ† (BloodPressure) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 20 ØªØ§ 120 mm Hg</label>
                <input type="number" id="bp" placeholder="Ù…Ø«Ø§Ù„: 72" min="0" step="0.1">
            </div>
            <div class="form-group">
                <label for="age" id="ageLabel">Ø³Ù† (Age)</label>
                <input type="number" id="age" placeholder="Ù…Ø«Ø§Ù„: 45" min="0" max="120">
            </div>
            <div class="form-group">
                <label for="dpf" id="dpfLabel">ØªØ§Ø¨Ø¹ Ø³Ø§Ø¨Ù‚Ù‡ Ø¯ÛŒØ§Ø¨Øª (DiabetesPedigreeFunction) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 0.08 ØªØ§ 2.4</label>
                <input type="number" id="dpf" placeholder="Ù…Ø«Ø§Ù„: 0.5" min="0" step="0.001">
            </div>

            <button class="btn" id="predictBtn">ğŸ” ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø¯ÛŒØ§Ø¨Øª!</button>
        </div>

        <div id="resultBox" class="result-box"></div>
    </div>

    <footer id="footer">
        Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ ØªÙˆØ³Ø· <strong>Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ù‚Ø§Ø³Ù…ÛŒ</strong> â€” Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø¨Ø§Ù„ÛŒÙ†ÛŒ Ø³Ø§Ø¯Ù‡â€Œ Ø´Ø¯Ù‡
    </footer>

    <script>
    const translations = {
        fa: {
            title: "Ø¯Ú©ØªØ±Ù Ø±ÙØ¨Ø§ØªÛŒÚ© ğŸ¤–ğŸ©º",
            subtitle: "ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯ÛŒØ§Ø¨Øª â€” Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ù¾Ø²Ø´Ú©ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯",
            infoNote: "â„¹ï¸ Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± ÛŒÚ© <strong>ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</strong> Ø§Ø³Øª â€” Ù†Ù‡ ØªØ´Ø®ÛŒØµ Ù¾Ø²Ø´Ú©ÛŒ.<br>Ù†ØªØ§ÛŒØ¬ØŒ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ù” Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ù…ØªØ®ØµØµ Ù‡Ø³ØªÙ†Ø¯.",
            glucoseLabel: "Ú¯Ù„ÙˆÚ©Ø² (Glucose) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 50 ØªØ§ 200 mg/dL",
            bmiLabel: "Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 15 ØªØ§ 60",
            bpLabel: "ÙØ´Ø§Ø± Ø®ÙˆÙ† (BloodPressure) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 20 ØªØ§ 120 mm Hg",
            ageLabel: "Ø³Ù† (Age)",
            dpfLabel: "ØªØ§Ø¨Ø¹ Ø³Ø§Ø¨Ù‚Ù‡ Ø¯ÛŒØ§Ø¨Øª (DiabetesPedigreeFunction) â€” Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† 0.08 ØªØ§ 2.4",
            predictBtn: "ğŸ” ØºØ±Ø¨Ø§Ù„Ú¯Ø±ÛŒ Ø¯ÛŒØ§Ø¨Øª!",
            alertInvalid: "âš ï¸ Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù…ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¹Ø¯Ø¯ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.",
            langToggleText: "ğŸ‡¬ğŸ‡§ English",
            placeholders: {
                glucose: "Ù…Ø«Ø§Ù„: 120",
                bmi: "Ù…Ø«Ø§Ù„: 32.0",
                bp: "Ù…Ø«Ø§Ù„: 72",
                age: "Ù…Ø«Ø§Ù„: 45",
                dpf: "Ù…Ø«Ø§Ù„: 0.5"
            },
            resultYes: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¯ÛŒØ§Ø¨Øª: <strong>Ø¨Ù„Ù‡</strong>",
            resultNo: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¯ÛŒØ§Ø¨Øª: <strong>Ø®ÛŒØ±</strong>",
            resultInfoYes: "Ø§ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù†Ø¸Ø± Ù¾Ø²Ø´Ú© Ù†ÛŒØ³Øª. Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ØŒ Ø­ØªÙ…Ø§Ù‹ Ø¨Ù‡ Ù…ØªØ®ØµØµ ØºØ¯Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.",
            resultInfoNo: "ØªØ¨Ø±ÛŒÚ©! Ø§Ù…Ø§ Ø³Ù„Ø§Ù…ØªÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ´Ú¯ÛŒØ±ÛŒ Ø¯Ø§Ø±Ø¯ â€” Ú†Ú©Ø§Ù¾ Ø³Ø§Ù„Ø§Ù†Ù‡ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ù†Ú©Ù†ÛŒØ¯.",
            footer: "Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ ØªÙˆØ³Ø· <strong>Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ù‚Ø§Ø³Ù…ÛŒ</strong> â€” Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‚ÙˆØ§Ø¹Ø¯ Ø¨Ø§Ù„ÛŒÙ†ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡"
        },
        en: {
            title: "Dr. Robotic ğŸ¤–ğŸ©º",
            subtitle: "Smart Diabetes Screening â€” Based on Standard Clinical Rules",
            infoNote: "â„¹ï¸ This tool provides <strong>preliminary screening</strong> â€” not medical diagnosis.<br>Results help you decide whether to consult a specialist.",
            glucoseLabel: "Glucose â€” typically 50â€“200 mg/dL",
            bmiLabel: "Body Mass Index (BMI) â€” typically 15â€“60",
            bpLabel: "Blood Pressure â€” typically 20â€“120 mm Hg",
            ageLabel: "Age",
            dpfLabel: "Diabetes Pedigree Function â€” typically 0.08â€“2.4",
            predictBtn: "ğŸ” Screen for Diabetes!",
            alertInvalid: "âš ï¸ Please fill all fields with valid numbers.",
            langToggleText: "ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ",
            placeholders: {
                glucose: "e.g. 120",
                bmi: "e.g. 32.0",
                bp: "e.g. 72",
                age: "e.g. 45",
                dpf: "e.g. 0.5"
            },
            resultYes: "Diabetes Risk: <strong>Yes</strong>",
            resultNo: "Diabetes Risk: <strong>No</strong>",
            resultInfoYes: "This result is NOT a substitute for professional medical advice. Please consult an endocrinologist.",
            resultInfoNo: "Congratulations! Still, prevention matters â€” donâ€™t skip your annual check-up.",
            footer: "Made with â¤ï¸ by <strong>Abolfazl Ghasemi</strong> â€” rule-based clinical decision support"
        }
    };

    let currentLang = localStorage.getItem('lang') || 'fa';
    const langToggle = document.getElementById('langToggle');

    function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('lang', lang);
        const t = translations[lang];

        document.getElementById('title').innerHTML = t.title;
        document.getElementById('subtitle').textContent = t.subtitle;
        document.getElementById('infoNote').innerHTML = t.infoNote;
        document.getElementById('glucoseLabel').textContent = t.glucoseLabel;
        document.getElementById('bmiLabel').textContent = t.bmiLabel;
        document.getElementById('bpLabel').textContent = t.bpLabel;
        document.getElementById('ageLabel').textContent = t.ageLabel;
        document.getElementById('dpfLabel').textContent = t.dpfLabel;
        document.getElementById('predictBtn').textContent = t.predictBtn;
        document.getElementById('footer').innerHTML = t.footer;
        langToggle.innerHTML = t.langToggleText;

        document.getElementById('glucose').placeholder = t.placeholders.glucose;
        document.getElementById('bmi').placeholder = t.placeholders.bmi;
        document.getElementById('bp').placeholder = t.placeholders.bp;
        document.getElementById('age').placeholder = t.placeholders.age;
        document.getElementById('dpf').placeholder = t.placeholders.dpf;

        document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
        document.documentElement.lang = lang;

        ['glucose', 'bmi', 'bp', 'age', 'dpf'].forEach(id => {
            const val = localStorage.getItem(`input_${id}_${lang}`);
            if (val) document.getElementById(id).value = val;
        });
    }

    setLanguage(currentLang);

    langToggle.addEventListener('click', () => {
        ['glucose', 'bmi', 'bp', 'age', 'dpf'].forEach(id => {
            const val = document.getElementById(id).value;
            if (val) localStorage.setItem(`input_${id}_${currentLang}`, val);
        });
        const newLang = currentLang === 'fa' ? 'en' : 'fa';
        setLanguage(newLang);
    });

    // --- Theme ---
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const html = document.documentElement;

    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    let currentTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');

    function setTheme(theme) {
        if (theme === 'dark') {
            html.setAttribute('data-theme', 'dark');
            themeIcon.textContent = 'â˜€ï¸';
        } else {
            html.removeAttribute('data-theme');
            themeIcon.textContent = 'ğŸŒ™';
        }
        localStorage.setItem('theme', theme);
        currentTheme = theme;
    }

    setTheme(currentTheme);

    themeToggle.addEventListener('click', () => {
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(newTheme);
    });

    // --- Predict Button ---
    document.getElementById('predictBtn').addEventListener('click', () => {
        const glucose = parseFloat(document.getElementById('glucose').value);
        const bmi = parseFloat(document.getElementById('bmi').value);
        const bp = parseFloat(document.getElementById('bp').value);
        const age = parseFloat(document.getElementById('age').value);
        const dpf = parseFloat(document.getElementById('dpf').value);

        // Basic validation: non-number inputs
        if ([glucose, bmi, bp, age, dpf].some(isNaN)) {
            alert(translations[currentLang].alertInvalid);
            return;
        }

        // === âœ… Clinical plausibility validation (added) ===
        const alerts = [];

        if (glucose < 20) alerts.push(currentLang === 'fa' 
            ? 'Ú¯Ù„ÙˆÚ©Ø² ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ø³ÛŒØ§Ø± Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³Øª (Ø²ÛŒØ± Û²Û° mg/dL) â€” Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§Ø´Ø¯.' 
            : 'Glucose is extremely low (<20 mg/dL) â€” likely input error.');
        if (glucose > 600) alerts.push(currentLang === 'fa' 
            ? 'Ú¯Ù„ÙˆÚ©Ø² ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§ Ø§Ø³Øª (Ø¨Ø§Ù„Ø§ÛŒ Û¶Û°Û° mg/dL) â€” Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.' 
            : 'Glucose is extremely high (>600 mg/dL) â€” please verify.');

        if (bmi < 10) alerts.push(currentLang === 'fa' 
            ? 'BMI ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ ØºÛŒØ±Ù‚Ø§Ø¨Ù„â€ŒØªØµÙˆØ± Ø§Ø³Øª (Ø²ÛŒØ± Û±Û°) â€” Ù…Ù…Ú©Ù† Ø§Ø³Øª ÙˆØ²Ù† ÛŒØ§ Ù‚Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.' 
            : 'BMI is unrealistically low (<10) â€” check height/weight input.');
        if (bmi > 90) alerts.push(currentLang === 'fa' 
            ? 'BMI ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø¨Ø³ÛŒØ§Ø± ØºÛŒØ±Ù…Ø¹Ù…ÙˆÙ„ Ø§Ø³Øª (Ø¨Ø§Ù„Ø§ÛŒ Û¹Û°) â€” Ù„Ø·ÙØ§Ù‹ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.' 
            : 'BMI is extremely high (>90) â€” please double-check inputs.');

        if (bp < 10) alerts.push(currentLang === 'fa' 
            ? 'ÙØ´Ø§Ø± Ø®ÙˆÙ† ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø®ÛŒÙ„ÛŒ Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³Øª (Ø²ÛŒØ± Û±Û° mmHg) â€” Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.' 
            : 'Blood pressure is critically low (<10 mmHg) â€” likely invalid.');
        if (bp > 300) alerts.push(currentLang === 'fa' 
            ? 'ÙØ´Ø§Ø± Ø®ÙˆÙ† ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø®ÛŒÙ„ÛŒ Ø¨Ø§Ù„Ø§ Ø§Ø³Øª (Ø¨Ø§Ù„Ø§ÛŒ Û³Û°Û° mmHg) â€” ØºÛŒØ±Ù…Ø¹Ù…ÙˆÙ„ Ø¯Ø± Ø§Ù†Ø³Ø§Ù†.' 
            : 'Blood pressure is extremely high (>300 mmHg) â€” biologically implausible.');

        if (age < 1) alerts.push(currentLang === 'fa' 
            ? 'Ø³Ù† Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù…ØªØ± Ø§Ø² Û± Ø³Ø§Ù„ Ø¨Ø§Ø´Ø¯.' 
            : 'Age cannot be less than 1 year.');
        if (age > 120) alerts.push(currentLang === 'fa' 
            ? 'Ø³Ù† Ø¨Ø§Ù„Ø§ÛŒ Û±Û²Û° Ø³Ø§Ù„ ØºÛŒØ±Ù…Ø¹Ù…ÙˆÙ„ Ø§Ø³Øª â€” Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.' 
            : 'Age >120 is highly unusual â€” please verify.');

        if (dpf < 0) alerts.push(currentLang === 'fa' 
            ? 'ØªØ§Ø¨Ø¹ Ø³Ø§Ø¨Ù‚Ù‡ Ø¯ÛŒØ§Ø¨Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯.' 
            : 'DPF cannot be negative.');
        if (dpf > 3) alerts.push(currentLang === 'fa' 
            ? 'DPF Ø¨Ø§Ù„Ø§ÛŒ Û³ Ø¨Ø³ÛŒØ§Ø± Ù†Ø§Ø¯Ø± Ø§Ø³Øª â€” Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨Ø§Ø´Ø¯.' 
            : 'DPF >3 is extremely rare â€” double-check input.');

        if (alerts.length > 0) {
            const t = translations[currentLang];
            const title = currentLang === 'fa' ? 'âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø§Ù„ÛŒÙ†ÛŒ' : 'âš ï¸ Clinical Warning';
            const confirmMsg = currentLang === 'fa' 
                ? 'Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆØ§Ø±Ø¯Ø´Ø¯Ù‡ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡Ù” Ù‚Ø§Ø¨Ù„â€ŒØ§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø³Ø§Ù† Ù‡Ø³ØªÙ†Ø¯.\n' +
                  'Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯ØŸ\n\nâ€¢ ' + alerts.join('\nâ€¢ ') 
                : 'Some values are outside biologically plausible ranges.\n' +
                  'Do you want to proceed anyway?\n\nâ€¢ ' + alerts.join('\nâ€¢ ');

            if (!confirm(`${title}\n\n${confirmMsg}`)) {
                return; // Cancel if user clicks "Cancel"
            }
        }

        // Save inputs
        ['glucose', 'bmi', 'bp', 'age', 'dpf'].forEach(id => {
            localStorage.setItem(`input_${id}_${currentLang}`, document.getElementById(id).value);
        });

        // --- Rule-based prediction (unchanged) ---
        let pred = 0;
        let ruleDesc = currentLang === 'fa' 
            ? 'Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø³ÛŒØ³ØªÙ…: Ø´Ø±Ø§ÛŒØ· Ø®Ø§ØµÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯' 
            : 'System default: No specific rule matched';

        if (glucose > 100 && glucose <= 154 && bmi > 45.3 && age > 29) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û± Ø¯ÛŒØ§Ø¨Øª: Ú¯Ù„ÙˆÚ©Ø² Û±Û°Û°â€“Û±ÛµÛ´ØŒ BMI > 45.3ØŒ Ø³Ù† > 29' : 'Rule 1: Glucose 100â€“154, BMI > 45.3, Age > 29';
        } else if (glucose > 154 && bmi > 29) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û² Ø¯ÛŒØ§Ø¨Øª: Ú¯Ù„ÙˆÚ©Ø² > 154 Ùˆ BMI > 29' : 'Rule 2: Glucose > 154 and BMI > 29';
        } else if (glucose > 154 && bp <= 76 && age <= 60) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û³ Ø¯ÛŒØ§Ø¨Øª: Ú¯Ù„ÙˆÚ©Ø² > 154ØŒ ÙØ´Ø§Ø± â‰¤ 76ØŒ Ø³Ù† â‰¤ 60' : 'Rule 3: Glucose > 154, BP â‰¤ 76, Age â‰¤ 60';
        } else if (glucose > 100 && bmi > 26.7 && dpf > 0.439 && age > 29) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û´ Ø¯ÛŒØ§Ø¨Øª: Ú¯Ù„ÙˆÚ©Ø² > 100ØŒ BMI > 26.7ØŒ DPF > 0.439ØŒ Ø³Ù† > 29' : 'Rule 4: Glucose > 100, BMI > 26.7, DPF > 0.439, Age > 29';
        } else if (bp <= 30 && bmi > 26.7 && age <= 29) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Ûµ Ø¯ÛŒØ§Ø¨Øª: ÙØ´Ø§Ø± â‰¤ 30ØŒ BMI > 26.7ØŒ Ø³Ù† â‰¤ 29' : 'Rule 5: BP â‰¤ 30, BMI > 26.7, Age â‰¤ 29';
        } else if (bp <= 44 && bmi > 26.7) {
            pred = 1; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û¶ Ø¯ÛŒØ§Ø¨Øª: ÙØ´Ø§Ø± â‰¤ 44 Ùˆ BMI > 26.7' : 'Rule 6: BP â‰¤ 44 and BMI > 26.7';
        } 
        else if (glucose <= 154 && bmi <= 26.7) {
            pred = 0; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û± Ø³Ù„Ø§Ù…Øª: Ú¯Ù„ÙˆÚ©Ø² â‰¤ 154 Ùˆ BMI â‰¤ 26.7' : 'Rule 1: Glucose â‰¤ 154 and BMI â‰¤ 26.7';
        } else if (glucose <= 100) {
            pred = 0; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û² Ø³Ù„Ø§Ù…Øª: Ú¯Ù„ÙˆÚ©Ø² â‰¤ 100' : 'Rule 2: Glucose â‰¤ 100';
        } else if (glucose <= 154 && bp > 30 && age <= 29) {
            pred = 0; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û³ Ø³Ù„Ø§Ù…Øª: Ú¯Ù„ÙˆÚ©Ø² â‰¤ 154ØŒ ÙØ´Ø§Ø± > 30ØŒ Ø³Ù† â‰¤ 29' : 'Rule 3: Glucose â‰¤ 154, BP > 30, Age â‰¤ 29';
        } else if (bmi <= 29 && age > 60) {
            pred = 0; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Û´ Ø³Ù„Ø§Ù…Øª: BMI â‰¤ 29 Ùˆ Ø³Ù† > 60' : 'Rule 4: BMI â‰¤ 29 and Age > 60';
        } else if (glucose <= 154 && bmi <= 45.3 && dpf <= 0.439) {
            pred = 0; ruleDesc = currentLang === 'fa' ? 'Ù‚Ø§Ø¹Ø¯Ù‡ Ûµ Ø³Ù„Ø§Ù…Øª: Ú¯Ù„ÙˆÚ©Ø² â‰¤ 154ØŒ BMI â‰¤ 45.3ØŒ DPF â‰¤ 0.439' : 'Rule 5: Glucose â‰¤ 154, BMI â‰¤ 45.3, DPF â‰¤ 0.439';
        }

        const box = document.getElementById('resultBox');
        box.className = `result-box result-${pred}`;
        box.style.display = 'block';

        const t = translations[currentLang];
        const basedOnText = currentLang === 'fa' ? 'Ø·Ø¨Ù‚' : 'Based on';
        box.innerHTML = pred === 1 ?
            `<span style="font-size:2.1rem">âš ï¸ ${t.resultYes}</span><br>
             <small>${basedOnText}: ${ruleDesc}</small>
             <div class="rule-info">
                ${t.resultInfoYes}
             </div>` :
            `<span style="font-size:2.1rem">âœ… ${t.resultNo}</span><br>
             <small>${basedOnText}: ${ruleDesc}</small>
             <div class="rule-info">
                ${t.resultInfoNo}
             </div>`;

        box.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
    </script>
</body>
</html>
